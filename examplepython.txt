"""
Embedded Python Blocks:

Each time this file is saved, GRC will instantiate the first class it finds
to get ports and parameters of your block. The arguments to __init__  will
be the parameters. All of them are required to have default values!
"""

import numpy as np
from gnuradio import gr
import pmt

class ChannelSelector(gr.sync_block):
	
	def __init__(self):
		gr.sync_block.__init__(self,
			name="ChannelSelector",
			in_sig=[(np.float32, 8)] * 8,
			out_sig=None)
		
		self.message_port_register_out(pmt.intern("out"))
		
	def work(self, input_items, output_items):
		
		threshold_values = input_items
		
		active_channels = []
		
		threshold = 0.2
		
		for idx, channel_threshold in enumerate(threshold_values):
			if np.any(channel_threshold > threshold):
				active_channels.append(idx)
		
		if len(active_channels) > 0:
			selected_channel = active_channels[0]
			
			self.message_port_pub(pmt.intern("out"), pmt.from_long(selected_channel))
			
		else:
			print("No active channels")
			
		return len(input_items[0])
